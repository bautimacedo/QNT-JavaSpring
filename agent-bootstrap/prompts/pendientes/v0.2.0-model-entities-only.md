# v0.2.0 ‚Äî Solo modelo: entidades y enums JPA (carpeta model)

**VERSI√ìN:** v0.2.0  
**SLUG:** model-entities-only  
**DEPENDENCIAS:** ninguna  
**ESTIMACI√ìN:** 1h 30min  
**PRIORIDAD:** alta

---

## Origen

> üóÇÔ∏è *Prompt generado por el Agente PM.*  
> *El cliente pidi√≥: generar √∫nicamente los archivos .java de la carpeta model (clases de entidad y enums), sin l√≥gica de negocio, repositorios, servicios ni controladores. La especificaci√≥n est√° en docs/ESTRUCTURA_BD_ENTIDADES.md y docs/ENTIDADES.md.*

---

## Descripci√≥n

Tu tarea es **generar exclusivamente** los archivos `.java` que corresponden al **modelo de datos** del backend: enums y entidades JPA en la carpeta `model`. No debes implementar l√≥gica de negocio, servicios, repositorios, controladores ni configuraci√≥n adicional.

**Alcance incluido:**
- Todos los **enums** definidos en la especificaci√≥n (Estado, TipoCompra, EstadoMision).
- Todas las **entidades** con sus atributos y relaciones JPA exactamente como en `docs/ESTRUCTURA_BD_ENTIDADES.md` y `docs/ENTIDADES.md`.
- Clases en el paquete `com.gestion.qnt.model` (ruta: `gestion/src/main/java/com/gestion/qnt/model/`).
- Anotaciones JPA: `@Entity`, `@Table`, `@Id`, `@GeneratedValue`, `@Column`, `@JoinColumn`, `@OneToMany`, `@ManyToOne`, `@OneToOne`, `@ManyToMany`, `@Enumerated`, `@Lob`, etc., seg√∫n corresponda a cada entidad.

**Alcance excluido (no hacer en este ticket):**
- Repositorios (`JpaRepository` o cualquier interfaz en `repository/`).
- Servicios, controladores REST, DTOs.
- L√≥gica de negocio, validaciones complejas m√°s all√° de anotaciones b√°sicas.
- Configuraci√≥n de BD, Flyway/Liquibase, tests.

---

## PASO 0 ‚Äî Contexto previo a leer

> ‚ö†Ô∏è Si ven√≠s del AGENTE_WORKFLOW.md, saltear este paso.

Leer sin ejecutar nada:

- `docs/ESTRUCTURA_BD_ENTIDADES.md` ‚Äî especificaci√≥n completa de cada entidad: atributos, tipos Java, relaciones (One-to-Many, Many-to-One, One-to-One, Many-to-Many), nombres de tabla y columnas.
- `docs/ENTIDADES.md` ‚Äî contexto de negocio y descripci√≥n de cada entidad.
- `gestion/pom.xml` ‚Äî confirmar que existan `spring-boot-starter-data-jpa` y `lombok` (puedes usar Lombok en las entidades si lo prefieres).

---

## PASO 1 ‚Äî Crear enums en `com.gestion.qnt.model`

En `gestion/src/main/java/com/gestion/qnt/model/` crear:

1. **Estado.java** ‚Äî enum con valores: `STOCK_ACTUAL`, `EN_PROCESO`, `STOCK_ACTIVO`, `EN_DESUSO` (usado en Dock, Dron, Bateria, Helice, AntenaRtk, AntenaStarlink).
2. **TipoCompra.java** ‚Äî enum con valores: `LICENCIA_SW`, `REPUESTO`, `COMBUSTIBLE`, `VIATICO`, `SEGURO`, `EQUIPO`, `OTRO`.
3. **EstadoMision.java** ‚Äî enum con valores: `PLANIFICADA`, `EN_CURSO`, `EJECUTADA`, `CANCELADA` (usado en Mision).

**Verificaci√≥n:** los tres enums compilan y est√°n en el paquete `com.gestion.qnt.model`.

---

## PASO 2 ‚Äî Crear entidades en orden de dependencias

Crear cada clase `@Entity` en `gestion/src/main/java/com/gestion/qnt/model/` siguiendo **estrictamente** los atributos y relaciones de `docs/ESTRUCTURA_BD_ENTIDADES.md`. Orden sugerido para evitar referencias circulares:

1. **Site** ‚Äî id, nombre. OneToMany a Dock, Pozo, Compra (mappedBy).
2. **Role** ‚Äî id, codigo (UNIQUE), nombre. ManyToMany con Usuario (tabla join `usuario_roles`).
3. **Usuario** ‚Äî id, nombre, apellido, email, password, roles (ManyToMany Role), dni, cmaVencimiento, cmaImagenes, horasVuelo, cantidadVuelos.
4. **Proveedor** ‚Äî id, nombre, cuit, contacto, direccion, telefono, email, observaciones (@Lob). OneToMany a Compra.
5. **Compra** ‚Äî id, proveedor (ManyToOne), fechaCompra, fechaFactura, numeroFactura, importe (BigDecimal), moneda, tipoCompra (enum), descripcion (@Lob), site (ManyToOne opcional), observaciones (@Lob).
6. **Seguro** ‚Äî id, aseguradora, numeroPoliza, vigenciaDesde, vigenciaHasta, observaciones (@Lob), compra (ManyToOne opcional).
7. **Licencia** ‚Äî id, nombre, numLicencia, compra (ManyToOne opcional), fechaCompra, caducidad, version, activo.
8. **MantenimientoDock** ‚Äî id, dock (ManyToOne), usuario (ManyToOne), fechaMantenimiento, observaciones (@Lob), fotos.
9. **Dock** ‚Äî id, marca, modelo, estado (enum), numeroSerie, nombre, fechaCompra, horasUso, seguro (ManyToOne), garantia, ultimoUso, ultimoMantenimiento (ManyToOne MantenimientoDock), site (ManyToOne), dron (OneToOne), licencia (ManyToOne), antenaRtk (OneToOne mappedBy), antenaStarlink (OneToOne mappedBy), mantenimientos (OneToMany MantenimientoDock).
10. **AntenaRtk** ‚Äî id, dock (OneToOne due√±o FK), marca, modelo, estado, numeroSerie, nombre, fechaCompra, ubicacion.
11. **AntenaStarlink** ‚Äî id, dock (OneToOne due√±o FK), marca, modelo, estado, numeroSerie, nombre, fechaCompra, **fechaInstalacion**.
12. **MantenimientoDron** ‚Äî id, dron (ManyToOne), usuario (ManyToOne), fechaMantenimiento, observaciones (@Lob), fotos; bateriaVieja, bateriaNueva (ManyToOne Bateria); helicesViejas, helicesNuevas (ManyToMany Helice con tablas join distintas: `mantenimiento_dron_helices_viejas` y `mantenimiento_dron_helices_nuevas`).
13. **Dron** ‚Äî id, marca, modelo, estado, numeroSerie, nombre, fechaCompra, diasParaMantenimiento, ultimoMantenimiento (ManyToOne MantenimientoDron), seguro (ManyToOne), garantia, licenciaAnac, cantidadVuelos, cantidadMinutosVolados, incidentes (@Lob), ultimoVuelo, dock (ManyToOne); OneToMany a Bateria, Helice, MantenimientoDron, Mision (mappedBy).
14. **Bateria** ‚Äî id, marca, modelo, estado, numeroSerie, nombre, fechaCompra, diasUso, ciclosCarga, **fechaStockActivo**, **fechaEnDesuso** (LocalDateTime), dron (ManyToOne).
15. **Helice** ‚Äî id, marca, modelo, estado, numeroSerie, nombre, fechaCompra, horasUso, diasUso, **fechaStockActivo**, **fechaEnDesuso** (LocalDateTime), dron (ManyToOne).
16. **Instalacion** ‚Äî id, usuario (ManyToOne), fecha, observaciones (@Lob), fotos; dock, dron, bateria, helice (todas ManyToOne nullable).
17. **Pozo** ‚Äî id, nombre, coordenadas, site (ManyToOne).
18. **Mision** ‚Äî id, nombre, linkRtsp, descripcion (@Lob), piloto (ManyToOne Usuario), dock, dron, pozo (ManyToOne); fechaCreacion, **ultimaEjecucion** (no fechaEjecucion), estado (enum EstadoMision).
19. **Log** ‚Äî id, entidadTipo, entidadId, timestamp (Instant), tipo, detalle (@Lob), usuario (ManyToOne opcional).

Usar `@Table(name = "snake_case")` seg√∫n la especificaci√≥n (ej. `docks`, `mantenimiento_dock`, `usuario_roles` para la join table). Todas las relaciones ManyToOne/OneToMany usar `FetchType.LAZY` para evitar problemas de carga circular.

**Verificaci√≥n:** `mvn -f gestion/pom.xml clean compile` termina sin errores. No es necesario que arranque Spring ni que exista BD; solo que las clases compilen.

---

## PASO 3 ‚Äî Verificaci√≥n final

- [ ] Existen exactamente 3 enums y 19 entidades en `gestion/src/main/java/com/gestion/qnt/model/`.
- [ ] Cada clase tiene los atributos y relaciones indicados en ESTRUCTURA_BD_ENTIDADES.md (y referencias en ENTIDADES.md).
- [ ] No hay c√≥digo en `repository/`, `service/`, `controller/` ni l√≥gica de negocio en las entidades.
- [ ] Build sin errores: `mvn -f gestion/pom.xml clean compile`.

---

## PASO N ‚Äî Commit y tag

```bash
VERSION="v0.2.0"
SLUG="model-entities-only"

git add gestion/src/main/java/com/gestion/qnt/model/

git commit --no-verify -m "feat(model): entidades y enums JPA en carpeta model

- Enums: Estado, TipoCompra, EstadoMision
- Entidades: Site, Role, Usuario, Proveedor, Compra, Seguro, Licencia
- Dock, AntenaRtk, AntenaStarlink, Dron, Bateria, Helice
- MantenimientoDock, MantenimientoDron, Instalacion, Pozo, Mision, Log
- Sin l√≥gica de negocio; solo modelo seg√∫n docs/ESTRUCTURA_BD_ENTIDADES.md"

git tag -a "${VERSION}" -m "Release v0.2.0: Solo modelo (entidades y enums)"
```

---

## Notas

- **Compra.importe** debe ser `java.math.BigDecimal`.
- **MantenimientoDron**: dos colecciones ManyToMany con Helice usando `@JoinTable` con nombres distintos para helicesViejas y helicesNuevas.
- Si ya existen algunos archivos en `model/`, reemplazarlos o ajustarlos para que coincidan con la especificaci√≥n; el objetivo es que la carpeta `model` quede completa y consistente con los docs.
- Relaciones bidireccionales: usar `mappedBy` en el lado que no tiene la FK para no duplicar tablas.
